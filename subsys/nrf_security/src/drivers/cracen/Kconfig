#
# Copyright (c) 2023 Nordic Semiconductor
#
# SPDX-License-Identifier: LicenseRef-Nordic-5-Clause
#

config CRACEN_HW_PRESENT
	def_bool SOC_SERIES_NRF54LX

# Configure CRACEN_LOG_LEVEL
module = CRACEN
module-str = CRACEN
source "${ZEPHYR_BASE}/subsys/logging/Kconfig.template.log_config"

if PSA_CRYPTO_DRIVER_CRACEN

config CRACEN_LOAD_MICROCODE
	bool "Load CRACEN microcode"
	depends on (SOC_SERIES_NRF54LX && !SOC_NRF54L20) || SOC_SERIES_NRF54HX
	default y
	help
	  Prompt-less configuration to load the CRACEN microcode.
	  This is required to use the PKE/IKG engine. Note that this is not
	  required when a bootloader has already loaded the microcode.

config CRACEN_LIB_KMU
	bool "CRACEN KMU library"
	depends on SOC_SERIES_NRF54LX
	select NRFX_RRAMC if !BUILD_WITH_TFM
	default y
	help
	  The CRACEN KMU library.

if CRACEN_LIB_KMU

config CRACEN_TRANSLATE_ITS_TO_KMU
	bool "Translate all PSA keys to KMU slots"
	help
	  It will translate all PSA ITS keys to KMU slots if the range is defined.
	  To use it you need to register a range to be translated, and specify the
	  maximum number of keys. If it is enabled the ITS won't be used and all keys
	  that are created by psa_generate_key or imported by psa_import_key will be
	  stored in KMU automatically if the slot is available.

config CRACEN_TRANSLATE_ITS_TO_KMU_ENCRYPTION
	bool "Encrypt all PSA keys before translating to KMU"
	depends on CRACEN_TRANSLATE_ITS_TO_KMU
	help
	  Encrypt all PSA keys before translating them to KMU slots.
	  This operation will require two additional slots in KMU for each key.

config CRACEN_TRANSLATE_ITS_TO_KMU_MAX_RANGES
	int "Maximum number of ranges to translate"
	depends on CRACEN_TRANSLATE_ITS_TO_KMU
	range 1 10
	default 3
	help
	  The maximum number of ranges to translate from PSA ITS to KMU slots.

config CRACEN_IKG_SEED_LOAD
	bool "Load the CRACEN IKG seed"
	default y
	help
	  The IKG seed is used to derive the keys in the IKG.
	  If there is no seed in KMU, it is expected to be generated.
	  Note that this is not required to be used if a bootloader is loading
	  KMU seed.

config CRACEN_IKG_SEED_KMU_SLOT
	int "KMU slot of the CRACEN IKG seed"
	range 0 183
	default 183
	help
	  The CRACEN IKG seed spans over 3 KMU slots:
	  the one defined here and the two subsequent ones.
	  This defines the KMU slot (along with the two following it) to which
	  the IKG seed is provisioned and that is pushed when loading the IKG seed.

endif # CRACEN_LIB_KMU

rsource 'psa_driver.Kconfig'

endif # PSA_CRYPTO_DRIVER_CRACEN
